<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f = "http://java.sun.com/jsf/core"
                template="./template/main.xhtml">

    <ui:define name="head">
        <link rel="stylesheet" href="#{request.contextPath}/resources/css/index.css" />
    </ui:define>
    
    <ui:define name="main">
        
<!--        <h:panelGroup id="test_appointments">
            <ul>
                <ui:repeat var="a" value="#{appointmentManagedBean.appointments.entrySet()}">

                        <li>#{a.getKey()}</li>
                        <ul>
                            <ui:repeat var="b" value="#{a.getValue()}">
                                <li>
                                    #{b} 
                                    <h:outputText value="#{b.date_time}">
                                        <f:convertDateTime pattern="dd/MM/yyyy h:mm a" />
                                    </h:outputText>
                                </li>
                            </ui:repeat>
                        </ul>

                </ui:repeat>
            </ul>
        </h:panelGroup>-->
        
        
        <p:poll interval="5" listener="#{appointmentManagedBean.getAllAppointmentsForToday()}" update="appointments appointmentCount" />
        <p:poll interval="5" update="queue queueCount" />
        
        
        <h:panelGroup id="appointments" class="left-container">
            
            <!--<h:panelGroup class="error-message">NO APPOINTMENTS TODAY</h:panelGroup>>--> 

            <ui:repeat var="appointment" value="#{appointmentManagedBean.getMyAppointments(sessionScope.user)}">
                
                <div class="row">

                    <div>
                        <div class="label-text">QUEUE NO</div>
                        <div>A001</div>
                    </div>
                    
                    <div>
                        <div class="label-text">APPT TIME</div>
                        <div>
                            <h:outputText value="#{appointment.date_time}">
                                <f:convertDateTime pattern="h:mm a" />
                            </h:outputText>
                        </div>
                    </div>

                    <div>
                        <div class="label-text">PATIENT NAME</div>
                        <div class="name" title="#{appointment.medical_record.name}">#{appointment.medical_record.name}</div>
                    </div>

                    <div>
                        <div class="label-text">AGE</div>
                        <div>
                            <h:outputText value="#{appointment.medical_record.dob}">
                                <f:converter converterId="ageConverter" />
                            </h:outputText>
                        </div>
                    </div>

                    <div>
                        <div class="label-text">ALLERGY</div>
                        <div>
                            <h:outputText value="#{appointment.medical_record.drug_allergys}">
                                <f:converter converterId="isListEmptyConverter" />
                            </h:outputText>
                        </div>
                    </div>

                    <div>
                        <div class="label-text">JOINED</div>
                        <div>
                            <h:outputText value="#{appointment.medical_record.date_created}">
                                <f:convertDateTime pattern="dd/MM/yyyy" />
                            </h:outputText>
                        </div>
                    </div>
                    
                </div>
                
            </ui:repeat>

        </h:panelGroup>

        <h:panelGroup id="queue" class="right-container">
            <!-- <div class="error-message">NO ONE IN QUEUE</div> -->

            <ui:repeat var="q" value="#{appointmentManagedBean.queue}">
                
                <div class="row">

                    <div>
                        <div class="label-text">QUEUE NO</div>
                        <div>W001</div>
                    </div>
                    
                    <div class="col">
                        <div class="label-text">APPT TIME</div>
                        <div>-</div>
                    </div>

                    <div>
                        <div class="label-text">PATIENT NAME</div>
                        <div class="name" title="#{q.medical_record.name}">#{q.medical_record.name}</div>
                    </div>

                    <div>
                        <div class="label-text">AGE</div>
                        <div>
                            <h:outputText value="#{q.medical_record.dob}">
                                <f:converter converterId="ageConverter" />
                            </h:outputText>
                        </div>
                    </div>

                    <div>
                        <div class="label-text">ALLERGY</div>
                        <div>
                            <h:outputText value="#{q.medical_record.drug_allergys}">
                                <f:converter converterId="isListEmptyConverter" />
                            </h:outputText>
                        </div>
                    </div>

                    <div>
                        <div class="label-text">JOINED</div>
                        <div>
                            <h:outputText value="#{q.medical_record.date_created}">
                                <f:convertDateTime pattern="dd/MM/yyyy" />
                            </h:outputText>
                        </div>
                    </div>
                    
                </div>
                
            </ui:repeat>
            
        </h:panelGroup>

        <h:panelGroup rendered="#{sessionScope.isLogin == true}">
            <div style="border:1px solid black; padding: 15px;display:inline-table;margin: 5px 0;position: fixed; bottom: 0; margin: 5px;background-color: white;">
                <h:outputText value="isLogin: #{sessionScope.isLogin}" /><br/>
                <h:outputText value="Session ID: #{session.id}" /><br/><br />
                <b>Logged in as:</b> <br />
                <h:outputText value="Emp ID: #{sessionScope.user.id}" /><br/>
                <h:outputText value="Name: #{sessionScope.user.name}" /><br/>
                <h:outputText value="Username: #{sessionScope.user.username}" /><br/>
                <h:outputText value="Password: #{sessionScope.user.password}" /><br/>
                <h:outputText value="Role: #{sessionScope.user.role}" /><br/>
            </div>
        </h:panelGroup>
        
    </ui:define>

</ui:composition>
